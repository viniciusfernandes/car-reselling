databaseChangeLog:
  - changeSet:
      id: vinicius-20260123-01
      author: vinicius
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS partners (
                id CHAR(36) PRIMARY KEY,
                name VARCHAR(255) NOT NULL UNIQUE,
                city VARCHAR(255) NULL,
                commission_rate DECIMAL(6,2) NULL,
                created_at DATETIME NOT NULL,
                updated_at DATETIME NULL
              );

              CREATE TABLE IF NOT EXISTS vehicles (
                id CHAR(36) PRIMARY KEY,
                license_plate VARCHAR(16) NOT NULL UNIQUE,
                renavam VARCHAR(32) NULL UNIQUE,
                vin VARCHAR(64) NULL UNIQUE,
                year INT NOT NULL,
                color VARCHAR(64) NOT NULL,
                model VARCHAR(128) NOT NULL,
                brand VARCHAR(128) NOT NULL,
                supplier_source VARCHAR(32) NOT NULL,
                purchase_price DECIMAL(13,2) NOT NULL,
                freight_cost DECIMAL(13,2) NOT NULL DEFAULT 0,
                purchase_payment_receipt_document_id CHAR(36) NULL,
                purchase_invoice_document_id CHAR(36) NULL,
                status VARCHAR(32) NOT NULL,
                assigned_partner_id CHAR(36) NULL,
                created_at DATETIME NOT NULL,
                updated_at DATETIME NULL,
                KEY idx_vehicles_status (status),
                KEY idx_vehicles_plate (license_plate),
                KEY idx_vehicles_partner (assigned_partner_id),
                CONSTRAINT fk_vehicles_partner FOREIGN KEY (assigned_partner_id) REFERENCES partners(id)
              );

              CREATE TABLE IF NOT EXISTS services (
                id CHAR(36) PRIMARY KEY,
                vehicle_id CHAR(36) NOT NULL,
                service_type VARCHAR(32) NOT NULL,
                description VARCHAR(500) NULL,
                service_value DECIMAL(13,2) NOT NULL,
                performed_at DATE NULL,
                created_at DATETIME NOT NULL,
                updated_at DATETIME NULL,
                KEY idx_services_vehicle (vehicle_id),
                CONSTRAINT fk_services_vehicle FOREIGN KEY (vehicle_id) REFERENCES vehicles(id)
              );

              CREATE TABLE IF NOT EXISTS documents (
                id CHAR(36) PRIMARY KEY,
                vehicle_id CHAR(36) NOT NULL,
                document_type VARCHAR(32) NOT NULL,
                original_file_name VARCHAR(512) NOT NULL,
                content_type VARCHAR(255) NOT NULL,
                size_bytes BIGINT NOT NULL,
                storage_key VARCHAR(1024) NOT NULL,
                uploaded_at DATETIME NOT NULL,
                uploaded_by VARCHAR(128) NULL,
                KEY idx_documents_vehicle (vehicle_id),
                CONSTRAINT fk_documents_vehicle FOREIGN KEY (vehicle_id) REFERENCES vehicles(id)
              );

  - changeSet:
      id: vinicius-20260123-02
      author: vinicius
      changes:
        - sql:
            sql: |
              INSERT INTO partners (id, name, city, commission_rate, created_at)
              VALUES
                (UUID(), 'Partner A', 'Sao Paulo', NULL, NOW()),
                (UUID(), 'Partner B', 'Rio de Janeiro', NULL, NOW());

  - changeSet:
      id: vinicius-20260123-03
      author: vinicius
      validCheckSum: ANY
      changes:
        - sql:
            sql: |
              INSERT INTO vehicles (
                id, license_plate, year, color, model, brand, supplier_source,
                purchase_price, freight_cost, status, created_at, updated_at
              ) VALUES (
                UUID(), 'ABC1234', 2019, 'Black', 'Civic', 'Honda',
                'INTERNET', 85000.00, 0, 'IN_LOT', NOW(), NOW()
              );
  - changeSet:
      id: vinicius-20260130-01
      author: vinicius
      changes:
        - sql:
            sql: |
              ALTER TABLE vehicles
                ADD COLUMN selling_price DECIMAL(13,2) NULL AFTER freight_cost;
  - changeSet:
      id: vinicius-20260206-01
      author: vinicius
      changes:
        - sql:
            sql: |
              ALTER TABLE vehicles
                ADD COLUMN purchase_commission DECIMAL(13,2) NOT NULL DEFAULT 0 AFTER freight_cost,
                ADD COLUMN distributed_at DATETIME NULL AFTER assigned_partner_id;

              UPDATE vehicles
              SET distributed_at = updated_at
              WHERE distributed_at IS NULL
                AND status IN ('DISTRIBUTED', 'SOLD');
  - changeSet:
      id: vinicius-20260211-01
      author: vinicius
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS brands (
                id CHAR(36) PRIMARY KEY,
                name VARCHAR(128) NOT NULL UNIQUE,
                created_at DATETIME NOT NULL,
                updated_at DATETIME NULL
              );

              CREATE TABLE IF NOT EXISTS models (
                id CHAR(36) PRIMARY KEY,
                brand_id CHAR(36) NOT NULL,
                name VARCHAR(128) NOT NULL,
                created_at DATETIME NOT NULL,
                updated_at DATETIME NULL,
                UNIQUE KEY uk_models_brand_name (brand_id, name),
                KEY idx_models_brand (brand_id),
                CONSTRAINT fk_models_brand FOREIGN KEY (brand_id) REFERENCES brands(id)
              );

              ALTER TABLE vehicles
                ADD COLUMN brand_id CHAR(36) NULL AFTER brand,
                ADD COLUMN model_id CHAR(36) NULL AFTER brand_id,
                ADD KEY idx_vehicles_brand (brand_id),
                ADD KEY idx_vehicles_model (model_id);

              INSERT INTO brands (id, name, created_at)
              SELECT UUID(), v.brand, NOW()
              FROM (SELECT DISTINCT brand FROM vehicles) v
              LEFT JOIN brands b ON b.name = v.brand
              WHERE b.id IS NULL;

              INSERT INTO models (id, brand_id, name, created_at)
              SELECT UUID(), b.id, v.model, NOW()
              FROM (SELECT DISTINCT brand, model FROM vehicles) v
              JOIN brands b ON b.name = v.brand
              LEFT JOIN models m ON m.brand_id = b.id AND m.name = v.model
              WHERE m.id IS NULL;

              UPDATE vehicles v
              JOIN brands b ON b.name = v.brand
              JOIN models m ON m.brand_id = b.id AND m.name = v.model
              SET v.brand_id = b.id,
                  v.model_id = m.id;

              ALTER TABLE vehicles
                MODIFY brand_id CHAR(36) NOT NULL,
                MODIFY model_id CHAR(36) NOT NULL,
                ADD CONSTRAINT fk_vehicles_brand FOREIGN KEY (brand_id) REFERENCES brands(id),
                ADD CONSTRAINT fk_vehicles_model FOREIGN KEY (model_id) REFERENCES models(id);